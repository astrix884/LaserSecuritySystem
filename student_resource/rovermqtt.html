<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ESP8266 Rover Control</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<style>
  body { font-family: Arial; background: #f2f2f2; padding: 20px; text-align: center; }
  .button { padding: 15px 25px; margin: 10px; border: none; border-radius: 8px; background: #007bff; color: white; cursor: pointer; font-size: 18px; }
  .button:active { background: #004a9f; }
  .slider { width: 200px; }
</style>
</head>
<body>
<h1>üöó ESP8266 Rover + Arm Control</h1>

<h3>Rover Movement (Hold Buttons or Use W A S D)</h3>
<p>Hold button or key ‚Üí Move<br>Release ‚Üí Stop</p>

<div>
  <button class="button" id="forwardBtn">‚¨ÜÔ∏è Forward</button><br>
  <button class="button" id="leftBtn">‚¨ÖÔ∏è Left</button>
  <button class="button" id="stopBtn">‚õî Stop</button>
  <button class="button" id="rightBtn">‚û°Ô∏è Right</button><br>
  <button class="button" id="backwardBtn">‚¨áÔ∏è Backward</button>
</div>

<hr>

<h3>Robotic Arm Control</h3>
<p>Base Servo</p>
<input type="range" id="servo1" class="slider" min="0" max="180" value="90" oninput="updateServo(1, this.value)">
<p>Arm Servo</p>
<input type="range" id="servo2" class="slider" min="0" max="180" value="90" oninput="updateServo(2, this.value)">
<p>Gripper Servo</p>
<input type="range" id="servo3" class="slider" min="0" max="180" value="90" oninput="updateServo(3, this.value)">

<script>
// ===== MQTT CONFIG =====
const client = mqtt.connect('wss://f5bc2a85c9c747488d7ab174eaa1faaf.s1.eu.hivemq.cloud:8884/mqtt', {
  username: "hivemq.webclient.1758715810298",
  password: "Y*9.%m2vj!rKJyLB1X0q"
});

client.on('connect', () => {
  console.log("Connected to HiveMQ Cloud");
});

function sendCommand(cmd) {
  client.publish('rover/move', cmd);
  console.log("Sent:", cmd);
}

function updateServo(num, val) {
  client.publish(`rover/servo${num}`, val);
  console.log(`Servo${num}:`, val);
}

// ===== Handle Button Hold/Release =====
const buttons = {
  forwardBtn: 'forward',
  backwardBtn: 'backward',
  leftBtn: 'left',
  rightBtn: 'right'
};

Object.keys(buttons).forEach(id => {
  const btn = document.getElementById(id);
  btn.addEventListener('mousedown', () => sendCommand(buttons[id]));
  btn.addEventListener('mouseup', () => sendCommand('stop'));
  btn.addEventListener('mouseleave', () => sendCommand('stop'));
});

// ===== WASD Key Controls =====
const keyMap = { w: 'forward', a: 'left', s: 'backward', d: 'right' };

document.addEventListener('keydown', (e) => {
  const cmd = keyMap[e.key.toLowerCase()];
  if (cmd) sendCommand(cmd);
});

document.addEventListener('keyup', (e) => {
  const cmd = keyMap[e.key.toLowerCase()];
  if (cmd) sendCommand('stop');
});
</script>
</body>
</html>
